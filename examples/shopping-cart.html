<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - MCP Bridge Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .bridge-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: #28a745;
            color: white;
            border-radius: 4px;
            font-size: 12px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .product {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        .product button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .cart-items {
            margin: 20px 0;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .cart-total {
            font-size: 18px;
            font-weight: bold;
            text-align: right;
            margin-top: 20px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="bridge-status">MCP Bridge Active</div>
    
    <div class="container">
        <h1>Shopping Cart Demo</h1>
        
        <h2>Products</h2>
        <div class="products" id="products">
            <!-- Products will be inserted here -->
        </div>
    </div>

    <div class="container">
        <h2>Cart</h2>
        <div class="cart-items" id="cartItems">
            <p>Your cart is empty</p>
        </div>
        <div class="cart-total" id="cartTotal">Total: $0.00</div>
        <button onclick="window.__MCP_BRIDGE__.execute('checkout')">Checkout</button>
    </div>

    <script>
        // Shopping Cart MCP Bridge
        class ShoppingCartBridge {
            constructor() {
                this.products = [
                    { id: 1, name: 'Laptop', price: 999.99 },
                    { id: 2, name: 'Mouse', price: 29.99 },
                    { id: 3, name: 'Keyboard', price: 79.99 },
                    { id: 4, name: 'Monitor', price: 299.99 }
                ];

                this.cart = [];

                this.actions = [
                    {
                        id: 'get_products',
                        type: 'custom',
                        description: 'Get all available products',
                        outputs: ['products']
                    },
                    {
                        id: 'add_to_cart',
                        type: 'custom',
                        description: 'Add a product to cart',
                        inputs: { productId: 'number', quantity: 'number' },
                        outputs: ['success', 'cart', 'total']
                    },
                    {
                        id: 'remove_from_cart',
                        type: 'custom',
                        description: 'Remove a product from cart',
                        inputs: { productId: 'number' },
                        outputs: ['success', 'cart', 'total']
                    },
                    {
                        id: 'update_quantity',
                        type: 'custom',
                        description: 'Update product quantity in cart',
                        inputs: { productId: 'number', quantity: 'number' },
                        outputs: ['success', 'cart', 'total']
                    },
                    {
                        id: 'get_cart',
                        type: 'custom',
                        description: 'Get current cart contents',
                        outputs: ['cart', 'total', 'itemCount']
                    },
                    {
                        id: 'checkout',
                        type: 'custom',
                        description: 'Process checkout',
                        outputs: ['success', 'orderId', 'total']
                    },
                    {
                        id: 'clear_cart',
                        type: 'custom',
                        description: 'Clear all items from cart',
                        outputs: ['success']
                    }
                ];

                this.initializeUI();
            }

            getManifest() {
                return {
                    page: 'shopping-cart',
                    version: '1.0.0',
                    actions: this.actions,
                    state: this.getState()
                };
            }

            getActions() {
                return this.actions;
            }

            getState() {
                return {
                    cartItems: this.cart.length,
                    cartTotal: this.calculateTotal(),
                    availableProducts: this.products.length,
                    timestamp: new Date().toISOString()
                };
            }

            async execute(actionId, params = {}) {
                console.log(`Executing action: ${actionId}`, params);

                switch (actionId) {
                    case 'get_products':
                        return { products: this.products };

                    case 'add_to_cart':
                        return this.addToCart(params.productId, params.quantity || 1);

                    case 'remove_from_cart':
                        return this.removeFromCart(params.productId);

                    case 'update_quantity':
                        return this.updateQuantity(params.productId, params.quantity);

                    case 'get_cart':
                        return {
                            cart: this.cart,
                            total: this.calculateTotal(),
                            itemCount: this.cart.reduce((sum, item) => sum + item.quantity, 0)
                        };

                    case 'checkout':
                        return this.checkout();

                    case 'clear_cart':
                        this.cart = [];
                        this.updateCartUI();
                        return { success: true };

                    default:
                        throw new Error(`Unknown action: ${actionId}`);
                }
            }

            addToCart(productId, quantity) {
                const product = this.products.find(p => p.id === productId);
                if (!product) {
                    return { success: false, error: 'Product not found' };
                }

                const existingItem = this.cart.find(item => item.productId === productId);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    this.cart.push({
                        productId,
                        name: product.name,
                        price: product.price,
                        quantity
                    });
                }

                this.updateCartUI();
                return {
                    success: true,
                    cart: this.cart,
                    total: this.calculateTotal()
                };
            }

            removeFromCart(productId) {
                this.cart = this.cart.filter(item => item.productId !== productId);
                this.updateCartUI();
                return {
                    success: true,
                    cart: this.cart,
                    total: this.calculateTotal()
                };
            }

            updateQuantity(productId, quantity) {
                const item = this.cart.find(item => item.productId === productId);
                if (!item) {
                    return { success: false, error: 'Item not in cart' };
                }

                if (quantity <= 0) {
                    return this.removeFromCart(productId);
                }

                item.quantity = quantity;
                this.updateCartUI();
                return {
                    success: true,
                    cart: this.cart,
                    total: this.calculateTotal()
                };
            }

            calculateTotal() {
                return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            }

            async checkout() {
                if (this.cart.length === 0) {
                    return { success: false, error: 'Cart is empty' };
                }

                const total = this.calculateTotal();
                const orderId = 'ORD-' + Date.now();

                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Clear cart after successful checkout
                this.cart = [];
                this.updateCartUI();

                alert(`Order ${orderId} placed successfully! Total: $${total.toFixed(2)}`);

                return {
                    success: true,
                    orderId,
                    total
                };
            }

            // UI Helper Methods
            initializeUI() {
                // Render products
                const productsContainer = document.getElementById('products');
                this.products.forEach(product => {
                    const productEl = document.createElement('div');
                    productEl.className = 'product';
                    productEl.innerHTML = `
                        <h3>${product.name}</h3>
                        <p>$${product.price.toFixed(2)}</p>
                        <button onclick="window.__MCP_BRIDGE__.execute('add_to_cart', { productId: ${product.id} })">
                            Add to Cart
                        </button>
                    `;
                    productsContainer.appendChild(productEl);
                });

                this.updateCartUI();
            }

            updateCartUI() {
                const cartItemsEl = document.getElementById('cartItems');
                const cartTotalEl = document.getElementById('cartTotal');

                if (this.cart.length === 0) {
                    cartItemsEl.innerHTML = '<p>Your cart is empty</p>';
                } else {
                    cartItemsEl.innerHTML = this.cart.map(item => `
                        <div class="cart-item">
                            <span>${item.name} (x${item.quantity})</span>
                            <span>
                                $${(item.price * item.quantity).toFixed(2)}
                                <button onclick="window.__MCP_BRIDGE__.execute('remove_from_cart', { productId: ${item.productId} })">
                                    Remove
                                </button>
                            </span>
                        </div>
                    `).join('');
                }

                cartTotalEl.textContent = `Total: $${this.calculateTotal().toFixed(2)}`;
            }
        }

        // Initialize bridge
        window.__MCP_BRIDGE__ = new ShoppingCartBridge();
        window.__MCP_MANIFEST__ = window.__MCP_BRIDGE__.getManifest();

        console.log('Shopping Cart MCP Bridge initialized:', window.__MCP_BRIDGE__);
    </script>
</body>
</html>